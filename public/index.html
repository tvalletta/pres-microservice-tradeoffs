<!doctype html>
<html>

<head>
  <title>Microservice Trade-offs</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="author" content="Thomas A. Valletta" />
  <link href="css/impress.css" rel="stylesheet" />
  <link href="css/prism.css" rel="stylesheet" />
  <style>
    @font-face {
      font-family: 'QlassikMediumRegular';
      src: url('css/font/Qlassik-Medium/Qlassik_TB-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;

    }

    @font-face {
      font-family: 'QlassikBoldRegular';
      src: url('css/font/Qlassik-Medium/QlassikBold_TB-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;

    }

    @font-face {
      font-family: 'Typewriter';
      src: url('css/font/Typewriter/veteran_typewriter-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'fira_code';
      src: url('css/font/firacode_regular_macroman/FiraCode-Regular-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'fira_codeMedium';
      src: url('css/font/firacode_medium_macroman/FiraCode-Medium-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'fira_codeBold';
      src: url('css/font/firacode_bold_macroman/FiraCode-Bold-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    .step {
      font-size: 2em;
    }

    .step.nofade {
      opacity: 1;
    }

    .step.invis {
      opacity: 0;
    }

    .step.invis.active {
      opacity: 1;
    }

    h1 {
      font-size: 128px;
      font-weight: bold;
      line-height: 164px;
      text-shadow: 1px 1px 2px #16324F;
      color: #FF8700;
    }

    h2 {
      font-size: 96px;
      line-height: 96px;
      color: #2A628F;
    }

    h3 {
      font-size: 64px;
      line-height: 64px;
      color: #16324F;
    }

    h4 {
      font-size: 48px;
      line-height: 48px;
      color: #13293D;
    }

    h5 {
      font-size: 32px;
      line-height: 32px;
    }

    h6 {
      font-size: 24px;
      line-height: 24px;
    }

    hr {
      border-color: #FFBC42;
    }

    table {
      border-bottom: 5px solid black;
      border-top: 5px solid black;
      height: 100%;
      width: 100%;
    }

    thead > tr {
      background-color: rgba(0, 0, 0, .1);
      color: #FF8700;
      font-size: 1.8em;
      font-weight: bold;
      line-height: 2em;
      text-align: left;
      text-shadow: 1px 1px 2px #16324F;
    }

    tbody > tr {
      border-top: 1px solid black;
      font-size: 1.3em;
      line-height: 2.5em;
    }

    th, td {
      padding-left: 14px;
    }

    table.images td {
      width: 200px;
      padding: 30px;
      text-align: center;
      vertical-align: middle;
      background-color: white;
    }

    ul {
      list-style: disc;
      margin-left: 14px;
      margin-right: 0px;
      padding-left: 10px;
      padding-right: 0px;
    }

    .small {
      font-size: 36px;
      color: #2A628F;
    }

    .x-small {
      font-size: 30px;
      color: #16324F;
    }

    .xx-small {
      font-size: 24px;
      color: #13293D;
    }

    .xxx-small {
      font-size: 18px;
      color: #13293D;
    }

    .right {
      float: right;
      width: 320px;
    }

    .left {
      float: left;
      width: 320px;
    }

    em {
      font-weight: bold;
      text-decoration: underline;
    }

    .blink {
      animation: blinker 1s linear infinite;
    }

    @keyframes blinker {  
      50% { opacity: 0; }
    }

    #voter {
      opacity: 0;
      transition: opacity .2s ease-in-out;
      position: absolute;
      right: 0;
      bottom: 0;
    }

    .answer > span {
      border-radius: 4px;
      margin: 0 11px;
      padding: 7px 7px 4px 9px;
    }

    .red { background-color: red; }
    .yellow { background-color: yellow; }
    .green { background-color: green; }
    .blue { background-color: blue; }
    
    .side-by-side {
      width: 800px;
    }
    .side-by-side > .left, .side-by-side > .right {
      width: 390px;
      font-size: .6em;
    }

    .thin-inline-code code {
      font-size: .7em;
      padding: 4px 11px 0 11px !important;
    }

  </style>
</head>

<body>
  <p class="fallback-message">
    Your browser doesn't support impress.js. Try Chrome or Safari.
  </p>
  <div id="impress">

    <div id="title" class="step stay" data-x="0" data-y="0">
      <h1 style="text-align: center">Microservice<br/>Trade-offs</h1>
    </div>
    
    <div id="description" class="step stay" data-x="0" data-y="800">
      <h2 style="text-align: center; color: black; background-color: rgba(0, 0, 0, .1); padding: .5em; border-radius: 6px;">The design of software applications as suites of independently deployable services.</h2>
    </div>

    <div id="table" class="step stay" data-x="0" data-y="1600">
      <table>
        <thead>
          <tr>
            <th>Advantages</th>
            <th>Disadvantages</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Contracts & Boundaries</td>
            <td>Distributed System</td>
          </tr>
          <tr>
            <td>Independent Deployment</td>
            <td>Eventual Consistency</td>
          </tr>
          <tr>
            <td>Technology Diversity</td>
            <td>Operational Complexity</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="step invis" data-x="600" data-y="1550" data-z="100" data-rotate-y="-90" data-scale=".3">
      <h3>Martin Fowler: MicroservicePremium</h3>
      <div style="text-align:center">
        <img src="img/productivity.png" alt="" style="width: 700px; box-shadow: 5px 5px 12px rgba(0, 0, 0, .5); background-color: white; padding: 22px;">
      </div>
    </div>
  
    <div class="step invis" data-x="650" data-y="1550" data-z="100" data-rotate-y="-90" data-scale=".3">
      <h4>Eventual consistency or distributed monolith</h4>
      <br />
      <ul>
        <li>
          Two types of distributed monoliths
          
          <ul>
            <li>Tight coupling via REST</li>
            <li>Required versions of platform libraries</li>
          </ul>
        </li>
        <li>
          Why eventual consistency is necessary
          <ul>
            <li>Decoupling often requires events/messages</li>
            <li>Multi-service data projections are not "real-time"</li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="step invis" data-x="700" data-y="1550" data-z="100" data-rotate-y="-90" data-scale=".3">
      <h3>Operational Complexity</h3>
      <table class="images">
        <tr>
          <td><img src="img/docker.png" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/kubernetes.png" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/aws-ecs.png" style="display: block; width: 100%; height: auto;"></td>
        </tr>
        <tr>
          <td><img src="img/consul.jpg" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/mesos.png" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/alpinelinux-logo.svg" style="display: block; width: 100%; height: auto;"></td>
        </tr>
        <tr>
          <td><img src="img/elastic_beanstalk_logo.png" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/docker-swarm.png" style="display: block; width: 100%; height: auto;"></td>
          <td><img src="img/gcp.png" style="display: block; width: 100%; height: auto;"></td>
        </tr>
      </table>

    </div>
  
    <div id="table" class="step stay" data-x="0" data-y="1600"></div>    

    <div class="step invis" data-x="-600" data-y="1550" data-z="100" data-rotate-y="90" data-scale=".3">
      <h2>Conway's Law</h2>
      <br />
      <h3>"Any organization that designs a system will inevitably produce a design whose structure is a copy of the organization's communication structure."</h3>
    </div>
  
    <div class="step invis" data-x="-650" data-y="1550" data-z="100" data-rotate-y="90" data-scale=".3">
      <h2>Harvard Business School Study of Conway's Law</h2>
      <br />
      <h3>Their study found that the often co-located, focused product teams created software that tended more towards tightly-coupled, monolithic codebases. Whereas the open source projects resulted in more modular, decomposed code bases.</h3>
    </div>

    <div class="step invis" data-x="-700" data-y="1550" data-z="100" data-rotate-y="90" data-scale=".3">
      <h2>Steve Yegge: ex-amazon employee rant</h2>
      <ul>
        <li>Data only via services</li>
        <li>Interprocess communication via services</li>
        <li>Absolutely no other interprocess communication</li>
        <li>Technology doesn't matter</li>
        <li>All services are public</li>
        <li>Deviations result in termination</li>
      </ul>
      <div class="notes" style="display: none">
        from: https://plus.google.com/+RipRowan/posts/eVeouesvaVX
        paragraph 5
      </div>
    </div>

    <div class="step invis" data-x="-750" data-y="1550" data-z="100" data-rotate-y="90" data-scale=".3">
      <h2>Netflix, Amazon, etc.</h2>
      <ul>
        <li>Small teams</li>
        <li>Focused responsibility</li>
        <li>Complete lifecycle ownership</li>
        <li>Independent evolution</li>
        <li>Faster delivery</li>
      </ul>
      <div class="notes" style="display: none">
        from: https://www.thoughtworks.com/insights/blog/demystifying-conways-law
        paragraph 5
      </div>
    </div>

    <div id="table" class="step stay" data-x="0" data-y="1600"></div>

    <div class="step invis" data-x="600" data-y="600"  data-z="200" data-rotate-x="-16" data-rotate-y="65"  data-rotate-z="-45">
      <h2>Resources & Bibliography</h2>
      <div>
        <div>Martin Fowler - Microservice Trade-offs<br/>https://martinfowler.com/articles/microservice-trade-offs.html</div>
        <div>Martin Fowler - Microservice Premium<br/>https://martinfowler.com/bliki/MicroservicePremium.html</div>
        <div>Sam Newman - Demystifying Conway's Law<br>https://www.thoughtworks.com/insights/blog/demystifying-conways-law</div>
      </div>
      <div class="right">
        <h3>Thanks</h3>
        Thomas A. Valletta
        <h5 style="color: yellow">@tvalletta</h5>
      </div>
    </div>
        
  </div>

  <div id="voter" width="200" height="200"></div>

  <script type="text/javascript" src="js/impress.js"></script>
  <script type='text/javascript' src="/socket.io/socket.io.js"></script>
  <script type='text/javascript' src="js/prism.js"></script>
  <script type='text/javascript' src="js/d3.v3.min.js"></script>
  <script type='text/javascript' src="js/stack-vis.js"></script>
  <script type='text/javascript' src="js/voter-pie.js"></script>

  <script>
    var socket = io()
    var el = document.getElementById("impress");

    let sv
    var hidden = [];
    var shown = [];
    var highlighted = [];
    var faded = [];

    el.addEventListener("impress:stepenter", function (event) {

      // --- stay ---
      if (event.target.classList.contains('stay')) {
        event.target.style.opacity = 1;
      }

      // --- data-show ---
      if (event.target.hasAttribute('data-show')) {
        var showList = event.target.getAttribute('data-show').split(' ');
        for (var i = 0; i < showList.length; ++i) {
          var $el = document.getElementById(showList[i]);
          shown.push({ el: $el, opacity: $el.style.opacity });
          $el.style.opacity = 1;
        }
      }

      // --- data-hide ---
      if (event.target.hasAttribute('data-hide')) {
        var hideList = event.target.getAttribute('data-hide').split(' ');
        for (var i = 0; i < hideList.length; ++i) {
          var $el = document.getElementById(hideList[i]);
          hidden.push({ el: $el, opacity: $el.style.opacity });
          $el.style.opacity = 0;
        }
      }

      // --- data-highlight ---
      if (event.target.hasAttribute('data-highlight')) {
        var highlightList = event.target.getAttribute('data-highlight').split(' ');
        for (var i = 0; i < highlightList.length; ++i) {
          var $el = document.getElementById(highlightList[i]);
          highlighted.push($el);
          $el.style['text-shadow'] = '0 0 5px white, 0 0 10px white, 0 0 30px white';
        }
      }

      // --- data-fade ---
      if (event.target.hasAttribute('data-fade')) {
        var fadeList = event.target.getAttribute('data-fade').split(' ')
        for (var i = 0; i < fadeList.length; ++i) {
          var $el = document.getElementById(fadeList[i])
          faded.push({ el: $el, opacity: $el.style.opacity })
          $el.style.opacity = 0.2
        }
      }

      // === CUSTOM CRAP ===z===z===z===z===z===z===z===z===z===z===z===z===z===

      // --- data-show-stack ---
      if (event.target.hasAttribute('data-show-stack')) {
        const cfg = {
          $el: event.target,
          dataset: [],
          dequeue: {
            interval: 16,
            count: .1
          },
          slow: 1
        }
        for (var i = 0; i < 100; ++i) {
          cfg.dataset[i] = {
            x: (Math.random() * 360) + 20,
            y: (Math.random() * 560) + 20,
            delay: i * 40
          }
        }
        sv = runStackVisualization(cfg)
      }
      // --- data-show-stack ---

    }, false)

    el.addEventListener("impress:stepleave", function (event) {

      // --- data-show ---
      if (hidden.length) {
        for (var i = 0; i < shown.length; ++i) {
          shown[i].el.style.opacity = shown[i].opacity
        }
        shown = [];
      }

      // --- data-hide ---
      if (hidden.length) {
        for (var i = 0; i < hidden.length; ++i) {
          hidden[i].el.style.opacity = hidden[i].opacity
        }
        hidden = [];
      }

      // --- data-highlighted ---
      if (highlighted.length) {
        for (var i = 0; i < highlighted.length; ++i) {
          highlighted[i].style['text-shadow'] = 'none'
        }
        highlighted = [];
      }

      // --- data-faded ---
      if (faded.length) {
        for (var i = 0; i < faded.length; ++i) {
          faded[i].el.style.opacity = faded[i].opacity
        }
        faded = []
      }

      // === CUSTOM CRAP ===z===z===z===z===z===z===z===z===z===z===z===z===z===

      // --- data-show-stack ---
      if (event.target.hasAttribute('data-show-stack')) {
        let $svg = event.target.querySelector('svg')
        $svg.remove()
      }

    }, false)

    document.addEventListener("impress:init", function (event) {

    })

    impress().init()

    // MWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMW
    // --- VOTER STUFF ---
    // MWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMWMW

    const $voter = document.getElementById('voter')
    const voter = voterPie({ $el: $voter })
    document.addEventListener('keydown', event => {
      switch (event.key) {
        case 's':
          $voter.style.opacity = 1
          break
        case 'h':
          $voter.style.opacity = 0
          break
        case 'r':
          console.log('reset()')
          socket.emit('reset')
          break
      }
    })

    socket.on('ack', msg => {
      console.log(msg)
      socket.emit('register', 'reporter')
    })

    socket.on('update', data => {
      console.log(data)
      voter.update(data)
      // voterPie({ $el: $voter, data })
    })

</script>
</body>

</html>